-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;

CREATE TABLE IF NOT EXISTS public.events
(
    id bigint NOT NULL,
    name text NOT NULL,
    category text NOT NULL,
    place text NOT NULL,
    event_start date NOT NULL,
    event_end date NOT NULL,
    arrive timestamp with time zone NOT NULL,
    depart timestamp with time zone NOT NULL,
    end_visa date NOT NULL,
    end_room date NOT NULL,
    organiser_id bigint NOT NULL,
    visa_mail text NOT NULL,
    visa_phone text NOT NULL,
    eju_price bigint NOT NULL,
    pcr_price bigint NOT NULL,
    ag_price bigint NOT NULL,
    trans_price bigint NOT NULL,
    other_price bigint NOT NULL,
    show_hotel boolean NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.clubs
(
    id bigint NOT NULL,
    state text NOT NULL,
    name text NOT NULL,
    address text NOT NULL,
    eju boolean NOT NULL,
    user_id bigint NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.jb
(
    id bigint NOT NULL,
    club_id bigint NOT NULL,
    jb text NOT NULL,
    name text NOT NULL,
    sur_name text NOT NULL,
    function text NOT NULL,
    birthday date NOT NULL,
    gender text NOT NULL,
    pass_id text NOT NULL,
    pass_release date NOT NULL,
    pass_expiration date NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.users
(
    id bigint NOT NULL,
    login text NOT NULL,
    phone text NOT NULL,
    full_name text NOT NULL,
    rule_id bigint NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.passwords
(
    id bigint NOT NULL,
    password text NOT NULL,
    login text NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.tokens
(
    id bigint NOT NULL,
    user_id bigint NOT NULL,
    token text NOT NULL,
    ip text NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.roles
(
    id bigint NOT NULL,
    "desc" bigint NOT NULL,
    PRIMARY KEY (id)
);

COMMENT ON TABLE public.roles
    IS 'rule 0 = admin, rule 1 = organiser, rule 2 = client';

CREATE TABLE IF NOT EXISTS public.hotels
(
    id bigint NOT NULL,
    name text NOT NULL,
    address text NOT NULL,
    mail text NOT NULL,
    web text NOT NULL,
    phone text NOT NULL,
    "package" boolean NOT NULL,
    p_nights bigint NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.rooms
(
    id bigint NOT NULL,
    bed bigint NOT NULL,
    price bigint NOT NULL,
    hotel_id bigint NOT NULL,
    available boolean NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.bed
(
    id bigint NOT NULL,
    room_id bigint NOT NULL,
    jb_id bigint NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.registered_clubs
(
    id bigint NOT NULL,
    event_id bigint NOT NULL,
    club_id bigint NOT NULL,
    visa boolean NOT NULL,
    checked boolean NOT NULL,
    PRIMARY KEY (id)
);

COMMENT ON TABLE public.registered_clubs
    IS 'clubs registered in event';

CREATE TABLE IF NOT EXISTS public.registered_hotels
(
    id bigint NOT NULL,
    event_id bigint NOT NULL,
    hotel_id bigint NOT NULL,
    PRIMARY KEY (id)
);

COMMENT ON TABLE public.registered_hotels
    IS 'hotel choosed for event';

CREATE TABLE IF NOT EXISTS public.registered_jb
(
    id bigint NOT NULL,
    reg_club_id bigint NOT NULL,
    jb_id bigint NOT NULL,
    arrive timestamp with time zone NOT NULL,
    departure timestamp with time zone NOT NULL,
    transport boolean NOT NULL,
    flight_number text NOT NULL,
    PRIMARY KEY (id)
);

COMMENT ON TABLE public.registered_jb
    IS 'people registered in event';

CREATE TABLE IF NOT EXISTS public.registered_tests
(
    id bigint NOT NULL,
    reg_jb_id bigint NOT NULL,
    pcr boolean NOT NULL,
    date timestamp with time zone NOT NULL,
    PRIMARY KEY (id)
);

COMMENT ON TABLE public.registered_tests
    IS 'covid tests registered in event';

COMMENT ON COLUMN public.registered_tests.pcr
    IS 'if false => anitgen';
END;